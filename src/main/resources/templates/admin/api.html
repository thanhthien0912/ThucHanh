<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <th:block th:insert="~{layout :: head}"></th:block>
    <title th:text="${pageTitle}">API Documentation</title>
</head>
<body class="flex flex-col min-h-screen">

    <header th:replace="~{layout :: header}"></header>
    <nav th:replace="~{layout :: navbar}"></nav>

    <main class="flex-grow-1">
        <div class="container mx-auto px-4 py-6">
            <!-- Header -->
            <div class="flex items-center justify-between mb-6">
                <h2 class="text-2xl font-semibold text-gray-800">
                    <i class="bi bi-code-slash mr-2"></i>API Documentation
                </h2>
                <span class="px-3 py-1 bg-yellow-500 text-white text-xs font-semibold rounded-full">ADMIN ONLY</span>
            </div>

            <!-- API Info -->
            <div class="bg-white rounded-lg shadow-sm border border-gray-100 mb-6">
                <div class="px-6 py-4 border-b border-gray-100 bg-primary-600 text-white">
                    <h5 class="text-lg font-semibold mb-0">
                        <i class="bi bi-info-circle mr-2"></i>Thông tin API
                    </h5>
                </div>
                <div class="p-6">
                    <div class="bg-blue-50 border-l-4 border-blue-500 text-blue-700 p-4 rounded-r-lg mb-4">
                        <div class="flex items-center gap-2">
                            <i class="bi bi-info-circle"></i>
                            <span class="font-medium"><strong>Đang phát triển:</strong> API RESTful sẽ được triển khai trong các bước tiếp theo.</span>
                        </div>
                    </div>

                    <h6 class="text-sm font-semibold text-gray-700 mb-2">Base URL</h6>
                    <code class="bg-gray-100 px-4 py-2 rounded block mb-4">http://localhost:8080/api/v1</code>

                    <h6 class="text-sm font-semibold text-gray-700 mb-2">Authentication</h6>
                    <p class="text-gray-600 text-sm">API sử dụng JWT Bearer token hoặc Basic Auth (đang phát triển)</p>
                </div>
            </div>

            <!-- API Endpoints -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                <div class="bg-white rounded-lg shadow-sm border border-gray-100">
                    <div class="px-6 py-4 border-b border-gray-100">
                        <h5 class="text-lg font-semibold text-gray-800 mb-0">
                            <i class="bi bi-book mr-2 text-primary-600"></i>Books API
                        </h5>
                    </div>
                    <div class="p-4 space-y-2">
                        <div class="p-3 bg-gray-50 rounded-lg">
                            <span class="inline-block px-2 py-0.5 bg-green-500 text-white text-xs font-medium rounded mr-2">GET</span>
                            <code class="text-sm text-gray-800">/api/v1/books</code>
                            <p class="text-xs text-gray-500 mt-1">Lấy danh sách tất cả sách</p>
                        </div>
                        <div class="p-3 bg-gray-50 rounded-lg">
                            <span class="inline-block px-2 py-0.5 bg-green-500 text-white text-xs font-medium rounded mr-2">GET</span>
                            <code class="text-sm text-gray-800">/api/v1/books/{id}</code>
                            <p class="text-xs text-gray-500 mt-1">Lấy thông tin sách theo ID</p>
                        </div>
                        <div class="p-3 bg-gray-50 rounded-lg">
                            <span class="inline-block px-2 py-0.5 bg-primary-600 text-white text-xs font-medium rounded mr-2">POST</span>
                            <code class="text-sm text-gray-800">/api/v1/books</code>
                            <p class="text-xs text-gray-500 mt-1">Thêm sách mới</p>
                        </div>
                        <div class="p-3 bg-gray-50 rounded-lg">
                            <span class="inline-block px-2 py-0.5 bg-yellow-500 text-white text-xs font-medium rounded mr-2">PUT</span>
                            <code class="text-sm text-gray-800">/api/v1/books/{id}</code>
                            <p class="text-xs text-gray-500 mt-1">Cập nhật thông tin sách</p>
                        </div>
                        <div class="p-3 bg-gray-50 rounded-lg">
                            <span class="inline-block px-2 py-0.5 bg-red-500 text-white text-xs font-medium rounded mr-2">DELETE</span>
                            <code class="text-sm text-gray-800">/api/v1/books/{id}</code>
                            <p class="text-xs text-gray-500 mt-1">Xóa sách</p>
                        </div>
                    </div>
                </div>

                <div class="bg-white rounded-lg shadow-sm border border-gray-100">
                    <div class="px-6 py-4 border-b border-gray-100">
                        <h5 class="text-lg font-semibold text-gray-800 mb-0">
                            <i class="bi bi-tags mr-2 text-green-600"></i>Categories API
                        </h5>
                    </div>
                    <div class="p-4 space-y-2">
                        <div class="p-3 bg-gray-50 rounded-lg">
                            <span class="inline-block px-2 py-0.5 bg-green-500 text-white text-xs font-medium rounded mr-2">GET</span>
                            <code class="text-sm text-gray-800">/api/v1/categories</code>
                            <p class="text-xs text-gray-500 mt-1">Lấy danh sách danh mục</p>
                        </div>
                        <div class="p-3 bg-gray-50 rounded-lg">
                            <span class="inline-block px-2 py-0.5 bg-green-500 text-white text-xs font-medium rounded mr-2">GET</span>
                            <code class="text-sm text-gray-800">/api/v1/categories/{id}</code>
                            <p class="text-xs text-gray-500 mt-1">Lấy thông tin danh mục</p>
                        </div>
                        <div class="p-3 bg-gray-50 rounded-lg">
                            <span class="inline-block px-2 py-0.5 bg-primary-600 text-white text-xs font-medium rounded mr-2">POST</span>
                            <code class="text-sm text-gray-800">/api/v1/categories</code>
                            <p class="text-xs text-gray-500 mt-1">Thêm danh mục mới</p>
                        </div>
                        <div class="p-3 bg-gray-50 rounded-lg">
                            <span class="inline-block px-2 py-0.5 bg-yellow-500 text-white text-xs font-medium rounded mr-2">PUT</span>
                            <code class="text-sm text-gray-800">/api/v1/categories/{id}</code>
                            <p class="text-xs text-gray-500 mt-1">Cập nhật danh mục</p>
                        </div>
                        <div class="p-3 bg-gray-50 rounded-lg">
                            <span class="inline-block px-2 py-0.5 bg-red-500 text-white text-xs font-medium rounded mr-2">DELETE</span>
                            <code class="text-sm text-gray-800">/api/v1/categories/{id}</code>
                            <p class="text-xs text-gray-500 mt-1">Xóa danh mục</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- API Documentation -->
            <div class="bg-white rounded-lg shadow-sm border border-gray-100 mb-6">
                <div class="px-6 py-4 border-b border-gray-100 bg-primary-600 text-white">
                    <h5 class="text-lg font-semibold mb-0">
                        <i class="bi bi-file-earmark-text mr-2"></i>API Documentation
                    </h5>
                </div>
                <div class="p-6">
                    <h6 class="text-sm font-semibold text-gray-700 mb-2">Base URL</h6>
                    <code class="bg-gray-100 px-4 py-2 rounded block mb-4">http://localhost:8080/api/v1</code>
                    
                    <h6 class="text-sm font-semibold text-gray-700 mb-2">Test bằng cURL</h6>
                    <div class="bg-gray-900 text-green-400 p-4 rounded-lg overflow-x-auto">
                        <pre class="text-xs"># Lấy danh sách sách
curl http://localhost:8080/api/v1/books

# Thêm sách mới
curl -X POST http://localhost:8080/api/v1/books \
  -H "Content-Type: application/json" \
  -d '{"title":"Test","author":"Test","price":100000}'</pre>
                    </div>
                </div>
            </div>

            <!-- API Test Panel -->
            <div class="bg-white rounded-lg shadow-sm border border-gray-100">
                <div class="px-6 py-4 border-b border-gray-100 bg-green-600 text-white">
                    <h5 class="text-lg font-semibold mb-0">
                        <i class="bi bi-lightning-charge mr-2"></i>Test API Trực Tiếp
                    </h5>
                </div>
                <div class="p-6">
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-3 mb-4">
                        <button onclick="testGetBooks()" class="px-4 py-3 bg-primary-600 text-white text-sm font-medium rounded-lg hover:bg-primary-700 transition-all">
                            <i class="bi bi-book mr-1"></i>GET /api/v1/books
                        </button>
                        <button onclick="testGetCategories()" class="px-4 py-3 bg-green-600 text-white text-sm font-medium rounded-lg hover:bg-green-700 transition-all">
                            <i class="bi bi-tags mr-1"></i>GET /api/v1/categories
                        </button>
                        <button onclick="testCreateBook()" class="px-4 py-3 bg-yellow-500 text-white text-sm font-medium rounded-lg hover:bg-yellow-600 transition-all">
                            <i class="bi bi-plus-circle mr-1"></i>POST /api/v1/books
                        </button>
                    </div>
                    
                    <!-- Result Display -->
                    <div>
                        <label class="text-sm font-semibold text-gray-700 mb-2 block">Kết quả:</label>
                        <pre id="apiResult" class="bg-gray-900 text-green-400 p-4 rounded-lg text-xs overflow-x-auto" style="min-height: 200px; max-height: 400px;">Nhấn nút ở trên để test API...</pre>
                    </div>
                </div>
            </div>

        </div>
    </main>

    <footer th:replace="~{layout :: footer}"></footer>
    <th:block th:insert="~{layout :: scripts}"></th:block>

    <!-- API Test Scripts -->
    <script>
        const API_BASE = '/api/v1';
        const resultDisplay = document.getElementById('apiResult');

        function displayResult(title, data) {
            const timestamp = new Date().toLocaleTimeString();
            resultDisplay.textContent = `[${timestamp}] ${title}\n\n${JSON.stringify(data, null, 2)}`;
        }

        function displayError(title, error) {
            const timestamp = new Date().toLocaleTimeString();
            resultDisplay.textContent = `[${timestamp}] ${title}\n\n❌ Lỗi: ${error}`;
        }

        // Test GET /api/v1/books
        async function testGetBooks() {
            try {
                resultDisplay.textContent = 'Đang gọi API...';
                const response = await fetch(`${API_BASE}/books`);
                const data = await response.json();
                displayResult('GET /api/v1/books', data);
            } catch (error) {
                displayError('GET /api/v1/books', error.message);
            }
        }

        // Test GET /api/v1/categories
        async function testGetCategories() {
            try {
                resultDisplay.textContent = 'Đang gọi API...';
                const response = await fetch(`${API_BASE}/categories`);
                const data = await response.json();
                displayResult('GET /api/v1/categories', data);
            } catch (error) {
                displayError('GET /api/v1/categories', error.message);
            }
        }

        // Test POST /api/v1/books
        async function testCreateBook() {
            try {
                resultDisplay.textContent = 'Đang gọi API...';
                const newBook = {
                    title: "Sách Test " + new Date().getTime(),
                    author: "Người Test",
                    price: 150000,
                    stock: 10,
                    description: "Đây là sách test được tạo từ API"
                };

                const response = await fetch(`${API_BASE}/books`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(newBook)
                });

                const contentType = response.headers.get("content-type");
                let data;
                if (contentType && contentType.indexOf("application/json") !== -1) {
                    data = await response.json();
                } else {
                    data = await response.text();
                }

                if (!response.ok) {
                    displayError('POST /api/v1/books', `HTTP ${response.status}: ${JSON.stringify(data)}`);
                    return;
                }

                displayResult('POST /api/v1/books', data);
            } catch (error) {
                displayError('POST /api/v1/books', error.message);
            }
        }
    </script>

</body>
</html>
