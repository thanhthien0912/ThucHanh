<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">

<head th:replace="~{layout :: head}"></head>

<body>
    <div th:replace="~{layout :: navbar}"></div>

    <main class="container mx-auto px-4 py-6">
        <!-- Tiêu đề -->
        <div class="flex items-center justify-between mb-6">
            <h2 class="text-2xl font-semibold text-gray-800">
                <i class="bi bi-cart3 mr-2"></i>Giỏ hàng của bạn
            </h2>
            <a th:href="@{/}" class="px-4 py-2 text-sm font-medium text-primary-600 border border-primary-300 rounded-lg hover:bg-primary-50 transition-all">
                <i class="bi bi-arrow-left mr-1"></i>Tiếp tục mua sắm
            </a>
        </div>

        <!-- Thông báo -->
        <div th:if="${success}" class="bg-green-50 border-l-4 border-green-500 text-green-700 p-4 rounded-r-lg mb-4 animate-fadeIn">
            <div class="flex items-center justify-between">
                <div class="flex items-center gap-2">
                    <i class="bi bi-check-circle"></i>
                    <span th:text="${success}"></span>
                </div>
                <button onclick="this.parentElement.parentElement.style.display='none'" class="text-green-700 hover:text-green-900">
                    <i class="bi bi-x-lg"></i>
                </button>
            </div>
        </div>
        <div th:if="${error}" class="bg-red-50 border-l-4 border-red-500 text-red-700 p-4 rounded-r-lg mb-4 animate-fadeIn">
            <div class="flex items-center justify-between">
                <div class="flex items-center gap-2">
                    <i class="bi bi-exclamation-triangle"></i>
                    <span th:text="${error}"></span>
                </div>
                <button onclick="this.parentElement.parentElement.style.display='none'" class="text-red-700 hover:text-red-900">
                    <i class="bi bi-x-lg"></i>
                </button>
            </div>
        </div>

        <!-- Danh sách sản phẩm -->
        <div th:if="${!cart.items.isEmpty()}" class="grid grid-cols-1 lg:grid-cols-3 gap-6">
            <div class="lg:col-span-2">
                <div class="bg-white rounded-lg shadow-sm border border-gray-100 overflow-hidden">
                    <div class="px-6 py-4 border-b border-gray-100 flex items-center justify-between">
                        <span class="font-medium text-gray-800">
                            <i class="bi bi-box mr-2"></i>Sản phẩm (<span th:text="${cart.totalItems}">0</span>)
                        </span>
                        <form th:action="@{/giohang/xoahet}" method="post" class="inline">
                            <button type="submit" class="px-3 py-1.5 text-xs font-medium text-red-600 border border-red-300 rounded hover:bg-red-50 transition-all"
                                onclick="return confirm('Bạn có chắc muốn xóa toàn bộ giỏ hàng?')">
                                <i class="bi bi-trash mr-1"></i>Xóa tất cả
                            </button>
                        </form>
                    </div>
                    <div class="divide-y divide-gray-100">
                        <div th:each="item : ${cart.items}" class="p-4 flex items-start gap-4 hover:bg-gray-50 transition-colors">
                            <!-- Ảnh sản phẩm -->
                            <div class="flex-shrink-0 w-16 h-20">
                                <img th:if="${item.imageUrl != null}" th:src="${item.imageUrl}"
                                    th:alt="${item.bookTitle}" class="w-full h-full object-cover rounded">
                                <div th:if="${item.imageUrl == null}"
                                    class="w-full h-full flex items-center justify-center text-white bg-gradient-to-br from-primary-500 to-purple-500 rounded">
                                    <i class="bi bi-book text-xl"></i>
                                </div>
                            </div>

                            <!-- Thông tin sản phẩm -->
                            <div class="flex-1 min-w-0">
                                <h3 class="font-semibold text-gray-900 truncate" th:text="${item.bookTitle}">Tên sách</h3>
                                <p class="text-sm text-gray-500" th:text="${item.author}">Tác giả</p>
                            </div>

                            <!-- Giá và số lượng -->
                            <div class="flex items-end gap-6">
                                <div class="text-right">
                                    <p class="text-sm text-gray-500">Đơn giá</p>
                                    <p class="font-bold text-red-600"
                                        th:text="${#numbers.formatDecimal(item.price, 0, 'COMMA', 0, 'POINT')} + ' đ'">
                                        100,000 đ
                                    </p>
                                </div>

                                <!-- Số lượng -->
                                <div class="flex items-center gap-2">
                                    <!-- Nút giảm -->
                                    <form th:action="@{/giohang/capnhat}" method="post" class="inline">
                                        <input type="hidden" name="bookId" th:value="${item.bookId}">
                                        <input type="hidden" name="quantity" th:value="${item.quantity - 1}">
                                        <button type="submit" class="w-8 h-8 flex items-center justify-center text-gray-600 border border-gray-200 rounded hover:bg-gray-100 transition-all" th:disabled="${item.quantity <= 1}">
                                            <i class="bi bi-dash text-xs"></i>
                                        </button>
                                    </form>

                                    <!-- Hiển thị số lượng -->
                                    <span class="w-10 h-8 flex items-center justify-center bg-gray-50 border border-gray-200 rounded text-sm font-medium" th:text="${item.quantity}">1</span>

                                    <!-- Nút tăng -->
                                    <form th:action="@{/giohang/capnhat}" method="post" class="inline">
                                        <input type="hidden" name="bookId" th:value="${item.bookId}">
                                        <input type="hidden" name="quantity" th:value="${item.quantity + 1}">
                                        <button type="submit" class="w-8 h-8 flex items-center justify-center text-gray-600 border border-gray-200 rounded hover:bg-gray-100 transition-all">
                                            <i class="bi bi-plus text-xs"></i>
                                        </button>
                                    </form>
                                </div>

                                <!-- Thành tiền -->
                                <div class="text-right">
                                    <p class="text-sm text-gray-500">Thành tiền</p>
                                    <p class="font-bold text-green-600"
                                        th:text="${#numbers.formatDecimal(item.subtotal, 0, 'COMMA', 0, 'POINT')} + ' đ'">
                                        100,000 đ
                                    </p>
                                </div>

                                <!-- Xóa -->
                                <form th:action="@{/giohang/xoa}" method="post" class="inline">
                                    <input type="hidden" name="bookId" th:value="${item.bookId}">
                                    <button type="submit" class="w-8 h-8 flex items-center justify-center text-red-600 border border-red-200 rounded hover:bg-red-50 transition-all">
                                        <i class="bi bi-trash text-xs"></i>
                                    </button>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Tổng tiền -->
            <div class="lg:col-span-1">
                <div class="bg-white rounded-lg shadow-sm border border-gray-100 sticky top-20">
                    <div class="px-6 py-4 border-b border-gray-100">
                        <span class="font-medium text-gray-800">
                            <i class="bi bi-receipt mr-2"></i>Tóm tắt đơn hàng
                        </span>
                    </div>
                    <div class="p-6 space-y-3">
                        <div class="flex justify-between text-sm">
                            <span class="text-gray-600">Số lượng:</span>
                            <span class="text-gray-900" th:text="${cart.totalItems} + ' sản phẩm'">0 sản phẩm</span>
                        </div>
                        <div class="flex justify-between text-sm">
                            <span class="text-gray-600">Tạm tính:</span>
                            <span class="text-gray-900" th:text="${#numbers.formatDecimal(cart.totalAmount, 0, 'COMMA', 0, 'POINT')} + ' đ'">0 đ</span>
                        </div>
                        <div class="flex justify-between text-sm">
                            <span class="text-gray-600">Phí vận chuyển:</span>
                            <span class="text-green-600 font-medium">Miễn phí</span>
                        </div>
                        <hr class="border-gray-200">
                        <div class="flex justify-between">
                            <span class="font-semibold text-gray-800">Tổng cộng:</span>
                            <span class="font-bold text-xl text-red-600"
                                th:text="${#numbers.formatDecimal(cart.totalAmount, 0, 'COMMA', 0, 'POINT')} + ' đ'">
                                0 đ
                            </span>
                        </div>
                        <a th:href="@{/thanhtoan}" class="block w-full py-3 bg-primary-600 text-white text-center font-medium rounded-lg hover:bg-primary-700 transition-all">
                            <i class="bi bi-credit-card mr-2"></i>Tiến hành thanh toán
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <div th:replace="~{layout :: footer}"></div>
    <div th:replace="~{layout :: scripts}"></div>
</body>

</html>